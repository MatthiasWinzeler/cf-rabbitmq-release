<%
  networks = spec.networks.marshal_dump.values
  network = networks.find do |network_spec|
    network_spec.default
  end

  network ||= networks.first
  job_address = network.address

  ips = link('rabbitmq-server').instances.map(&:address)

  if ips.size <= 1 then
    ips = [job_address]
  end

  require 'digest'
  cookie = p('rabbitmq-server.cookie', Digest::MD5.hexdigest(ips.join))

  nodes = ips.map do |ip|
    "'rabbit@#{ip}'"
  end.join(",")
%>


export SELF_NODE="rabbit@<%= spec.address %>"
export RABBITMQ_NODES_STRING="<%= nodes %>"
export ERLANG_COOKIE="<%= cookie %>"
